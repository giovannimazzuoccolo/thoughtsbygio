---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import Header from '../components/Header.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const [featuredPost, ...otherPosts] = posts;
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			.featured {
				margin-bottom: 4rem;
				padding-bottom: 3rem;
				border-bottom: 2px solid rgb(var(--gray-light));
			}
			
			.featured img {
				width: 100%;
				border-radius: 12px;
				margin-bottom: 1.5rem;
			}
			
			.featured h1 {
				margin-bottom: 1rem;
				font-size: 2.5rem;
			}
			
			.featured .excerpt {
				font-size: 1.1rem;
				line-height: 1.7;
				margin: 1.5rem 0;
				color: rgb(var(--text-secondary));
			}
			
			.read-more {
				color: var(--accent);
				text-decoration: none;
				font-weight: 500;
				border-bottom: 1px solid transparent;
				transition: border-color 0.2s ease;
			}
			
			.read-more:hover {
				border-bottom-color: var(--accent);
			}
			
			.other-posts h2 {
				margin-bottom: 2rem;
				font-size: 2rem;
			}
			
			.posts-grid {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 2rem;
				list-style: none;
				padding: 0;
				margin: 0;
			}
			
			.posts-grid li a {
				display: block;
				text-decoration: none;
				transition: transform 0.2s ease;
			}
			
			.posts-grid li a:hover {
				transform: translateY(-2px);
			}
			
			.posts-grid img {
				width: 100%;
				height: 200px;
				object-fit: cover;
				border-radius: 8px;
				margin-bottom: 1rem;
			}
			
			.posts-grid h3 {
				margin: 0 0 0.5rem 0;
				font-size: 1.25rem;
				color: rgb(var(--black));
			}
			
			.posts-grid .date {
				margin: 0;
				color: rgb(var(--gray));
				font-size: 0.9rem;
			}
			
			@media (max-width: 768px) {
				.featured h1 {
					font-size: 2rem;
				}
				
				.posts-grid {
					grid-template-columns: 1fr;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			{featuredPost && (
				<article class="featured">
					{featuredPost.data.heroImage && (
						<Image 
							width={800} 
							height={400} 
							src={featuredPost.data.heroImage} 
							alt={featuredPost.data.title} 
						/>
					)}
					<h1>{featuredPost.data.title}</h1>
					<p class="date">
						<FormattedDate date={featuredPost.data.pubDate} />
					</p>
					<p class="excerpt">
						{featuredPost.data.description || featuredPost.body.slice(0, 300) + '...'}
					</p>
					<a href={`/blog/${featuredPost.id}/`} class="read-more">Read full article</a>
				</article>
			)}
			
			{otherPosts.length > 0 && (
				<>
					<div class="ornamental-divider"></div>
					<section class="other-posts">
						<h2>More Articles</h2>
						<ul class="posts-grid">
							{otherPosts.map((post) => (
								<li>
									<a href={`/blog/${post.id}/`}>
										{post.data.heroImage && (
											<Image 
												width={400} 
												height={200} 
												src={post.data.heroImage} 
												alt={post.data.title} 
											/>
										)}
										<h3>{post.data.title}</h3>
										<p class="date">
											<FormattedDate date={post.data.pubDate} />
										</p>
									</a>
								</li>
							))}
						</ul>
					</section>
				</>
			)}
		</main>
		<Footer />
	</body>
</html>
